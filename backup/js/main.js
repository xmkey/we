!function(a){function b(b,c){this.container=a(b),this.canvas=document.createElement("canvas"),this.canvas.width=a(b).width(),this.canvas.height=a(b).height(),this.canvas2=document.createElement("canvas"),this.canvas2.width=a(b).width(),this.canvas2.height=a(b).height(),a(this.canvas).appendTo(b),a(this.canvas2).appendTo(b),this.canvas.getContext&&(this.ctx=this.canvas.getContext("2d"),this.ctx2=this.canvas2.getContext("2d")),this.line=c,this.init()}var c=[{from:{x:30,y:20},to:{x:100,y:100}},{from:{x:100,y:100},to:{x:200,y:20}},{from:{x:200,y:20},to:{x:100,y:50}},{from:{x:100,y:50},to:{x:300,y:80}},{from:{x:300,y:80},to:{x:250,y:40}},{from:{x:250,y:40},to:{x:200,y:20}},{from:{x:200,y:20},to:{x:30,y:20}}],d=a("#game-container");b.prototype={init:function(){var a=this.ctx,b=this.line;this.points=this._getPoints(),a.beginPath(),this.lineArr=[],this.nextArr=[],this.offset=this.container.offset();for(var c=0;c<b.length;c++)b[c].check=0,a.moveTo(b[c].from.x,b[c].from.y),a.lineTo(b[c].to.x,b[c].to.y);a.lineWidth=1,a.strokeStyle="#CC0000",a.stroke(),this._bind()},_getPoints:function(){for(var b={},c=this.line,d=0;d<c.length;d++){var e=c[d].from.x,f=c[d].from.y,g=c[d].to.x,h=c[d].to.y;if(!b[e+","+f]){var i=a("<div class='point'></div").appendTo(this.container);i.data("x",e),i.data("y",f),i.css({left:e-i.width()/2,top:f-i.height()/2}),b[e+","+f]=i}if(!b[g+","+h]){var i=a("<div class='point'></div").appendTo(this.container);i.data("x",g),i.data("y",h),i.css({left:g-i.width()/2,top:h-i.height()/2}),b[g+","+h]=i}}return b},_bind:function(){var b=this;a(document).on("touchstart",function(a){b._onstart(a,b)}),a(document).on("touchmove",function(a){b._onmove(a,b)}),a(document).on("touchend",function(a){b._onend(a,b)})},_onstart:function(b,c){if(c.lineArr=[],a(b.target).hasClass("point")){c.lineArr.push(a(b.target)),c.nextArr=[];for(var d=parseInt(a(b.target).data("x")),e=parseInt(a(b.target).data("y")),f=0;f<c.line.length;f++)c.line[f].from.x==d&&c.line[f].from.y==e&&c.nextArr.push({x:c.line[f].to.x,y:c.line[f].to.y,pos:f}),c.line[f].to.x==d&&c.line[f].to.y==e&&c.nextArr.push({x:c.line[f].from.x,y:c.line[f].from.y,pos:f})}},_onmove:function(b,c){if(c.lineArr.length){var d=c.ctx2,e=b.touches[0].pageX,f=b.touches[0].pageY;d.clearRect(0,0,c.canvas2.width,c.canvas2.height);var g=document.elementFromPoint(e,f);if(a(g).hasClass("point"))for(var h=parseInt(a(g).data("x")),i=parseInt(a(g).data("y")),j=0;j<c.nextArr.length;j++)if(h==c.nextArr[j].x&&i==c.nextArr[j].y){c.lineArr.push(a(g)),c.line[c.nextArr[j].pos].check=1,c.nextArr=[];for(var k=0;k<c.line.length;k++)c.line[k].from.x==h&&c.line[k].from.y==i&&0==c.line[k].check&&c.nextArr.push({x:c.line[k].to.x,y:c.line[k].to.y,pos:k}),c.line[k].to.x==h&&c.line[k].to.y==i&&0==c.line[k].check&&c.nextArr.push({x:c.line[k].from.x,y:c.line[k].from.y,pos:k});break}d.beginPath(),d.moveTo(parseInt(c.lineArr[0].data("x")),parseInt(c.lineArr[0].data("y")));for(var j=1;j<c.lineArr.length;j++){var h=parseInt(c.lineArr[j].data("x")),i=parseInt(c.lineArr[j].data("y"));d.lineTo(h,i)}d.lineTo(e-c.offset.left,f-c.offset.top),d.lineWidth=2,d.strokeStyle="#000000",d.stroke()}b.preventDefault()},_onend:function(a,b){b.nextArr=[];for(var c=0;c<b.line.length;c++)b.line[c].check=0;b.ctx2.clearRect(0,0,b.canvas2.width,b.canvas2.height)}},new b(d,c)}(Zepto);